package com.iteason.controller;

import java.util.HashMap;
import java.util.Map;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.RequestMapping;
import org.springframework.web.bind.annotation.ResponseBody;
import org.springframework.web.multipart.MultipartFile;

import com.iteason.utils.FastDFSClient;

@Controller
public class PictureController {

	/**
	 * 
	 * @author 阿荣
	 * @Description:图片上传
	 * @date: 2018年8月14日 下午1:17:57
	 * @param image
	 * @return
	 * @throws Exception 
	 */
	@RequestMapping(value="/pic/upload")
	@ResponseBody
	public Map uploadPicture(MultipartFile image) throws Exception {
		//调用图片服务器fastDfs的客户端
		FastDFSClient client = new FastDFSClient("classpath:client.conf");//加载配置文件
		byte[] fileContent = image.getBytes();//文件内容
		String originName = image.getOriginalFilename();//原始文件名
		int dotIndex = originName.indexOf(".");//获得.的索引
		String extName = originName.substring(dotIndex + 1);//获得扩展名
		//调用客户端进行文件上传，回显一个上传地址
		try {
			String file = client.uploadFile(fileContent, extName);
			//图片上传成功
			System.out.println(file);
			
			//json数据回显
			Map<String, Object> map = new HashMap<>();
			map.put("error",0);
			map.put("url", file);
			return map;
		} catch (Exception e) {
			//图片上传失败
			//json数据回显
			Map<String, Object> map = new HashMap<>();
			map.put("error",1);
			map.put("messae", "图片上传失败");
			return map;
		}
		
		
		//根据富文本编辑器的图片上传回显要求进行json回显（成功时：error:0,url:xxx。失败时:error:1,message:错误信息）
		
		
		
		
		
	}
}
